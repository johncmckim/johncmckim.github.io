---
layout: blog
category: blog
title: "Serverless Architectures"
subtitle: Building a Serverless system to solve a problem
poster_img: https://cdn-images-1.medium.com/max/2600/1*nqFDeya8VK-ZS7ckXLaGnQ.jpeg
description: >
    I have been researching and learning about Serverless Architectures since May 2016.
    Until recently I had been working on small projects. These projects focused on learning about different Serverless frameworks and deploying Serverless projects...
---

![](https://cdn-images-1.medium.com/max/2600/1*nqFDeya8VK-ZS7ckXLaGnQ.jpeg)

# Serverless Architectures
## Building a Serverless system to solve a problem

I have been researching and learning about Serverless Architectures since May 2016. Until recently I had been working on small projects. These projects focused on learning about different Serverless frameworks and deploying Serverless projects. These were good learning experiences for me. Yet, small projects do not explore many of the benefits of Serverless Architectures. It was time for me to look at making something larger.

## The Problem

While [I love gardening](https://medium.com/@johncmckim/apartment-gardening-79bb88867a66), I often forget to water my plants. My garden is on my balcony and only receives water when I water the plants. If I fail to water my plants, the plants wilt and die. To prevent this, I wanted a system that would inform me when my plants need watering.

There are two key halves to this problem. The first half is soil moisture sensing and data ingestion. I need a device in my plants that will measure soil moisture and send it somewhere for processing. The other half is the user facing monitoring and notifications. I need an alert sent to me when the moisture drops below a particular level.

![Monitoring dashboard](https://cdn-images-1.medium.com/max/3952/1*hSyVk2HkAQMOY1xe47WzKw.png)*Monitoring dashboard*

## Choosing Serverless

I chose to build this as a Serverless system to increase my knowledge and for fun. But, there are other reasons why a Serverless Architecture is a good choice for this system. To explain why it is a good choice, I want to attempt to define Serverless Architectures.
> # A Serverless Architecture is an event driven system that utilises [FaaS](https://serverless.zone/abstracting-the-back-end-with-faas-e5e80e837362) and other fully managed services for logic and persistence.

Serverless Architectures are different to systems built on PaaS services as they are event driven and have a [different unit of scale](https://serverless.zone/abstracting-the-back-end-with-faas-e5e80e837362).

An event driven system is a natural fit for the problem I am attempting to solve. Soil measurement events are generated by the device every 15 minutes. Notifications are only sent in response to a low moisture level event. Requests for monitoring data by users will be volatile and unpredictable. A Serverless Architecture allows me to worry less about listening to events and focus on responding to events.

![Slack notifications for low moisture levels](https://cdn-images-1.medium.com/max/2418/1*DPIhKUF4ugJ4vphmGnXbZg.png)*Slack notifications for low moisture levels*

## Serverless Architecture

To solve this problem I created a system with the architecture as below.

![](https://cdn-images-1.medium.com/max/3772/1*iXpexWQHU0Be7FsAfzVkLg.png)

### Sensors and IoT Hub

The [AWS IoT Service](https://aws.amazon.com/iot/) provides a secure way to connect devices to AWS. Devices can publish events to the IoT Hub for processing by the IoT Rules Engine. The rules engine can store data in DynamoDB, invoke Lambda functions [and more](http://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html).

The AWS IoT service is the boundary between the sensors and the users. The IoT rules respond to sensor events and perform actions which form the inputs of the user systems. In this case that is storing the soil moisture levels DynamoDb and invoking a Lambda function in the notification system.

### Web

The monitoring system is a Web based dashboard. The client is a React based Single Page Application (SPA) hosted on Firebase. The backend is a GraphQL endpoint built with API Gateway, Lambda and DynamoDb. Auth0 provides for authentication for the dashboard. Users login through the client and pass a token to the backend.

### Notifications

The notifications system sends messages to a Slack channel. The IoT hub invokes a Lambda function for each sensor data event. The Lambda function decides whether or not to send a notification. To notify the client, the decider publishes a message on a SNS topic. The SNS topic invokes another Lambda function which sends a message to Slack.

There are alternative ways to design this system. But this design keeps each Lambda focused on one task. It also makes it easy to add other notifications in the future, Text message, Email, ect.

## What’s next

Over the coming weeks I plan on writing about how I implemented each component. The project is far from perfect, but many of the components are already implemented. If you want a sneak peek at the code you can find it on [Github](https://github.com/garden-aid). To learn about more about GraphQL and the Serverless Framework try this [video course](https://acloud.guru/learn/serverless-with-graphql) that covers both in-depth.

If you want to read about how I created each component, follow [Serverless Zone](https://serverless.zone/) and myself on Medium or [Twitter](https://twitter.com/johncmckim).

### Update: Posts on the components

* [GraphQL with the Serverless Framework](https://serverless.zone/graphql-with-the-serverless-framework-79924829a8ca) — Building a dashboard for my garden

* [Slack Webhooks with the Serverless Framework](https://serverless.zone/slack-webhooks-with-the-serverless-framework-4c01bb3c1411) — Building a notifications system for my garden

* [AWS IoT with the Serverless Framework](https://serverless.zone/iot-with-the-serverless-framework-e228fae87be) — Building a monitoring system for my garden
